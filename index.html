<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üèõÔ∏è –ò–µ—Ä–∞—Ä—Ö–∏—è Prizm Imperium</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="data.js" defer></script>
    <script src="visualization.js" defer></script>
    <style>
        /* –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ */
        .debug-status {
            position: fixed;
            top: 10px;
            left: 10px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            z-index: 10000;
        }
    </style>
</head>
<body>
    <div class="debug-status" id="debug-status">
        –°—Ç–∞—Ç—É—Å: –ó–∞–≥—Ä—É–∑–∫–∞...
    </div>
    
    <div class="container">
        <!-- –®–∞–ø–∫–∞ -->
        <header class="header">
            <div class="header-content">
                <h1 class="title">üèõÔ∏è Prizm Imperium</h1>
                <p class="subtitle">–ò–µ—Ä–∞—Ä—Ö–∏—è –∏–º–ø–µ—Ä–∏–∏ | –û–±–Ω–æ–≤–ª–µ–Ω–æ: <span id="update-date">–ó–∞–≥—Ä—É–∑–∫–∞...</span></p>
                <div class="stats-bar">
                    <div class="stat">
                        <span class="stat-value" id="total-rulers">0</span>
                        <span class="stat-label">–ü—Ä–∞–≤–∏—Ç–µ–ª–µ–π</span>
                    </div>
                    <div class="stat">
                        <span class="stat-value" id="active-rulers">0</span>
                        <span class="stat-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö</span>
                    </div>
                    <div class="stat">
                        <span class="stat-value" id="total-connections">0</span>
                        <span class="stat-label">–°–≤—è–∑–µ–π</span>
                    </div>
                    <div class="stat">
                        <span class="stat-value" id="update-time">0</span>
                        <span class="stat-label">—Å–µ–∫ –Ω–∞–∑–∞–¥</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- –ü–æ–∏—Å–∫ -->
        <div class="search-section">
            <div class="search-container">
                <input type="text" 
                       id="search-input" 
                       placeholder="–ü–æ–∏—Å–∫ –ø–æ ID –∏–ª–∏ –∏–º–µ–Ω–∏..."
                       autocomplete="off">
                <button id="search-btn" class="btn">üîç –ü–æ–∏—Å–∫</button>
                <button id="clear-search" class="btn btn-secondary">‚ùå –û—á–∏—Å—Ç–∏—Ç—å</button>
                <button id="highlight-connections" class="btn">üîó –°–≤—è–∑–∏</button>
                <button id="reset-view" class="btn">‚ü≤ –°–±—Ä–æ—Å</button>
            </div>
            <div class="search-results" id="search-results"></div>
        </div>

        <!-- –ì—Ä–∞—Ñ–∏–∫ -->
        <div class="visualization-section">
            <svg id="graph" width="100%" height="700"></svg>
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>–ó–∞–≥—Ä—É–∑–∫–∞ –∏–µ—Ä–∞—Ä—Ö–∏–∏...</p>
            </div>
        </div>

        <!-- –õ–µ–≥–µ–Ω–¥–∞ -->
        <div class="legend-section">
            <div class="legend">
                <h3>üìã –õ–µ–≥–µ–Ω–¥–∞</h3>
                <div class="legend-items" id="legend-items">
                    <div class="legend-item">
                        <div class="legend-color" style="background: #FFD700; border-color: #FFD700"></div>
                        <div class="legend-text">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</div>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #4CAF50; border-color: #4CAF50"></div>
                        <div class="legend-text">–ê–∫—Ç–∏–≤–Ω—ã–π</div>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #FF9800; border-color: #FF9800"></div>
                        <div class="legend-text">–û–∂–∏–¥–∞–µ—Ç</div>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #9E9E9E; border-color: #9E9E9E"></div>
                        <div class="legend-text">–ù–µ–∞–∫—Ç–∏–≤–Ω—ã–π</div>
                    </div>
                </div>
            </div>
            
            <div class="controls">
                <h3>üéÆ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h3>
                <ul class="controls-list">
                    <li>‚Ä¢ <strong>–ü–æ–∏—Å–∫</strong> - –≤–≤–µ–¥–∏—Ç–µ ID –∏–ª–∏ –∏–º—è</li>
                    <li>‚Ä¢ <strong>–ö–ª–∏–∫</strong> –Ω–∞ —É–∑–µ–ª - –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏</li>
                    <li>‚Ä¢ <strong>–ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ</strong> - –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ —É–∑–ª–æ–≤</li>
                    <li>‚Ä¢ <strong>–ö–æ–ª–µ—Å–∏–∫–æ</strong> - –º–∞—Å—à—Ç–∞–±</li>
                    <li>‚Ä¢ <strong>–î–≤–æ–π–Ω–æ–π –∫–ª–∏–∫</strong> - —Å–±—Ä–æ—Å –º–∞—Å—à—Ç–∞–±–∞</li>
                    <li>‚Ä¢ <strong>"–°–≤—è–∑–∏"</strong> - –ø–æ–∫–∞–∑–∞—Ç—å —Å–≤—è–∑–∏ –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —É–∑–ª–∞</li>
                </ul>
            </div>

            <div class="info-panel" id="node-info">
                <h3>üë§ –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–∞–≤–∏—Ç–µ–ª—è</h3>
                <p>–ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –ª—é–±–æ–π —É–∑–µ–ª –∏–ª–∏ –Ω–∞–π–¥–∏—Ç–µ —á–µ—Ä–µ–∑ –ø–æ–∏—Å–∫</p>
            </div>
        </div>

        <!-- –ü–æ–¥—Å–∫–∞–∑–∫–∞ -->
        <div class="tooltip" id="tooltip"></div>

        <!-- –ü–æ–¥–≤–∞–ª -->
        <footer class="footer">
            <p>Prizm Imperium Hierarchy Visualizer | –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</p>
            <p class="footer-note">–î–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –±—Ä–∞—É–∑–µ—Ä</p>
        </footer>
    </div>

    <!-- –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∫–æ–Ω—Å–æ–ª—å -->
    <div id="debug-console" style="
        position: fixed;
        bottom: 10px;
        right: 10px;
        background: rgba(0,0,0,0.85);
        color: white;
        padding: 15px;
        border-radius: 8px;
        font-family: monospace;
        font-size: 12px;
        max-width: 400px;
        max-height: 300px;
        overflow: auto;
        z-index: 9999;
        border-left: 4px solid #FF4081;
        display: none;
    ">
        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
            <strong>–ö–æ–Ω—Å–æ–ª—å –æ—à–∏–±–æ–∫</strong>
            <button onclick="document.getElementById('debug-console').style.display='none'" 
                    style="background: #FF4081; color: white; border: none; padding: 2px 8px; border-radius: 4px; cursor: pointer;">X</button>
        </div>
        <div id="debug-log"></div>
    </div>

    <script>
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é console.log
        const originalConsoleLog = console.log;
        const originalConsoleError = console.error;
        const originalConsoleWarn = console.warn;

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –æ—Ç–ª–∞–¥–æ—á–Ω–æ–π –∫–æ–Ω—Å–æ–ª–∏
        function showInDebugConsole(type, color, ...args) {
            const debugLog = document.getElementById('debug-log');
            const debugConsole = document.getElementById('debug-console');
            const debugStatus = document.getElementById('debug-status');
            
            if (!debugLog || !debugConsole) return;
            
            debugConsole.style.display = 'block';
            
            const timestamp = new Date().toLocaleTimeString();
            const message = args.map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg) : String(arg)
            ).join(' ');
            
            const logMsg = `
                <div style="color: ${color}; margin-bottom: 5px; border-bottom: 1px solid #444; padding-bottom: 5px;">
                    <strong>${type} ${timestamp}</strong><br>
                    ${message}
                </div>
            `;
            
            debugLog.innerHTML = logMsg + debugLog.innerHTML;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
            if (debugStatus) {
                if (type === '‚ùå') {
                    debugStatus.style.background = 'rgba(255, 0, 0, 0.8)';
                    debugStatus.innerHTML = `–û—à–∏–±–∫–∞: ${message.substring(0, 50)}...`;
                } else if (type === '‚ö†Ô∏è') {
                    debugStatus.style.background = 'rgba(255, 165, 0, 0.8)';
                }
            }
        }

        // –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º console.log
        console.log = function(...args) {
            showInDebugConsole('üìù', '#4ECDC4', ...args);
            originalConsoleLog.apply(console, args);
        };

        // –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º console.error
        console.error = function(...args) {
            showInDebugConsole('‚ùå', '#FF6B6B', ...args);
            originalConsoleError.apply(console, args);
        };

        // –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º console.warn
        console.warn = function(...args) {
            showInDebugConsole('‚ö†Ô∏è', '#FFD166', ...args);
            originalConsoleWarn.apply(console, args);
        };

        // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º –≤—Å–µ –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏
        window.addEventListener('error', function(event) {
            showInDebugConsole('‚ùå', '#FF0000', 
                `–û—à–∏–±–∫–∞: ${event.message}`, 
                `–§–∞–π–ª: ${event.filename || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}`, 
                `–°—Ç—Ä–æ–∫–∞: ${event.lineno || '?'}:${event.colno || '?'}`
            );
        });

        // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º promise rejections
        window.addEventListener('unhandledrejection', function(event) {
            showInDebugConsole('‚ùå', '#FF0000', 
                'Unhandled Promise Rejection:', 
                event.reason
            );
        });

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≥—Ä—É–∑–∫—É —Å–∫—Ä–∏–ø—Ç–æ–≤
        document.addEventListener('DOMContentLoaded', function() {
            console.log('=== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –°–¢–†–ê–ù–ò–¶–´ ===');
            console.log('DOM –∑–∞–≥—Ä—É–∂–µ–Ω');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≥—Ä—É–∑–∫—É D3.js
            if (typeof d3 === 'undefined') {
                console.error('D3.js –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ');
            } else {
                console.log('‚úÖ D3.js –∑–∞–≥—Ä—É–∂–µ–Ω, –≤–µ—Ä—Å–∏—è:', d3.version);
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≥—Ä—É–∑–∫—É –Ω–∞—à–∏—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤
            setTimeout(function() {
                console.log('–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫—Ä–∏–ø—Ç–æ–≤...');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º data.js
                if (typeof getVisualizationData === 'undefined') {
                    console.error('‚ùå –§—É–Ω–∫—Ü–∏—è getVisualizationData –Ω–µ –Ω–∞–π–¥–µ–Ω–∞! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π–ª data.js');
                } else {
                    console.log('‚úÖ –§—É–Ω–∫—Ü–∏—è getVisualizationData –Ω–∞–π–¥–µ–Ω–∞');
                    try {
                        const data = getVisualizationData();
                        console.log('‚úÖ –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã:', data.nodes.length, '—É–∑–ª–æ–≤,', data.links.length, '—Å–≤—è–∑–µ–π');
                    } catch (e) {
                        console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ getVisualizationData:', e.message);
                    }
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º ImperialVisualizer
                if (typeof ImperialVisualizer === 'undefined') {
                    console.error('‚ùå –ö–ª–∞—Å—Å ImperialVisualizer –Ω–µ –Ω–∞–π–¥–µ–Ω! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π–ª visualization.js');
                } else {
                    console.log('‚úÖ –ö–ª–∞—Å—Å ImperialVisualizer –Ω–∞–π–¥–µ–Ω');
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
                const debugStatus = document.getElementById('debug-status');
                if (debugStatus) {
                    debugStatus.style.background = 'rgba(0, 128, 0, 0.8)';
                    debugStatus.innerHTML = '‚úÖ –°–∫—Ä–∏–ø—Ç—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã';
                }
            }, 100);
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ç–æ—Ä–∞ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ–≥–æ
        window.addEventListener('load', function() {
            console.log('=== –ü–û–õ–ù–ê–Ø –ó–ê–ì–†–£–ó–ö–ê –°–¢–†–ê–ù–ò–¶–´ ===');
            console.log('–í—Å–µ —Ä–µ—Å—É—Ä—Å—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã');
            
            // –î–∞–µ–º –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É –¥–ª—è –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
            setTimeout(function() {
                try {
                    if (typeof ImperialVisualizer !== 'undefined' && typeof getVisualizationData !== 'undefined') {
                        console.log('üöÄ –ó–∞–ø—É—Å–∫ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ç–æ—Ä–∞...');
                        window.visualizer = new ImperialVisualizer();
                        console.log('‚úÖ –í–∏–∑—É–∞–ª–∏–∑–∞—Ç–æ—Ä –∑–∞–ø—É—â–µ–Ω —É—Å–ø–µ—à–Ω–æ');
                    } else {
                        console.error('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ç–æ—Ä: –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞–≥—Ä—É–∑–∫—É —Å–∫—Ä–∏–ø—Ç–æ–≤');
                        document.getElementById('loading').innerHTML = 
                            '<div style="color: #f44336; text-align: center; padding: 20px;">‚ùå –û—à–∏–±–∫–∞: –Ω–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é</div>';
                    }
                } catch (error) {
                    console.error('‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ç–æ—Ä–∞:', error);
                    document.getElementById('loading').innerHTML = 
                        '<div style="color: #f44336; text-align: center; padding: 20px;">‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: ' + error.message + '</div>';
                }
            }, 500);
        });

        // –û—Ç–ª–∞–¥–æ—á–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—Ä—É—á–Ω—É—é
        window.debug = {
            checkData: function() {
                console.log('=== –ü–†–û–í–ï–†–ö–ê –î–ê–ù–ù–´–• ===');
                if (typeof getVisualizationData !== 'undefined') {
                    const data = getVisualizationData();
                    console.log('–î–∞–Ω–Ω—ã–µ:', data);
                    console.log('–£–∑–ª—ã:', data.nodes);
                    console.log('–°–≤—è–∑–∏:', data.links);
                    return data;
                } else {
                    console.error('getVisualizationData –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞');
                    return null;
                }
            },
            
            checkD3: function() {
                console.log('=== –ü–†–û–í–ï–†–ö–ê D3 ===');
                console.log('D3 –¥–æ—Å—Ç—É–ø–µ–Ω?', typeof d3 !== 'undefined');
                if (typeof d3 !== 'undefined') {
                    console.log('–í–µ—Ä—Å–∏—è D3:', d3.version);
                    console.log('d3.select —Ä–∞–±–æ—Ç–∞–µ—Ç?', typeof d3.select === 'function');
                    console.log('d3.forceSimulation –¥–æ—Å—Ç—É–ø–µ–Ω?', typeof d3.forceSimulation === 'function');
                }
            },
            
            clearLogs: function() {
                document.getElementById('debug-log').innerHTML = '';
            }
        };
    </script>
</body>
</html>
